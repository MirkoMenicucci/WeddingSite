<!DOCTYPE html>
<html>
<body>
    
    <form id="confPresenza">
        <input type="text" id="nome" placeholder="nome" />
        <input type="text" id="cognome" placeholder="cognome" />
        <button type="button" id="ricerca">Ricerca</button>
    </form>
    <form id="contMember">
        <textarea id="note" placeholder="Indica se ci sono allergie o particolari richieste sul cibo."></textarea>
    </form>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var listaPartecipanti = [
            {
                "family":"Prete",
                "membri":[
                    {
                        "nome":"Simone",
                    },
                    {
                        "nome":"Lidia",
                    },
                    {
                        "nome":"Lisa",
                    },
                ]
            },
            {
                "family":"Viscito",
                "membri":[
                    {
                        "nome":"Bruno",
                    },
                    {
                        "nome":"Riccardo",
                    },
                    {
                        "nome":"Jacopo",
                    },
                    {
                        "nome":"Anna",
                    },
                ]
            }
        ]

        $(document).ready(function(){
            $("#ricerca").on("click",function(){
                ricerca()
            })
            $("#contMember").hide()
        })

        function ricerca() {
            var cognome = $("#cognome").val().toLowerCase(); // Convert to lowercase for case-insensitive search
            var nome = $("#nome").val().toLowerCase(); // Convert to lowercase for case-insensitive search
            var matchingParticipants = [];

            for (var i = 0; i < listaPartecipanti.length; i++) {
                var currentFamily = listaPartecipanti[i];

                if (currentFamily.family.toLowerCase() === cognome) {
                    for (var j = 0; j < currentFamily.membri.length; j++) {
                        var currentMember = currentFamily.membri[j];
                        matchingParticipants.push({
                            cognome: currentFamily.family,
                            nome: currentMember.nome
                        });
                    }
                    break; // Una volta trovata la famiglia, possiamo uscire dal ciclo principale
                }
            }

            // Ordinare l'array in modo che il membro con il nome specificato sia al primo posto
            matchingParticipants.sort(function(a, b) {
                if (a.nome.toLowerCase() === nome) {
                    return -1;
                }
                if (b.nome.toLowerCase() === nome) {
                    return 1;
                }
                // Se nessuno dei due nomi corrisponde, ordinare alfabeticamente
                return a.nome.toLowerCase().localeCompare(b.nome.toLowerCase());
            });

            step1(matchingParticipants,cognome)
        }

        function step1(array,family){
            $("#confPresenza").fadeOut()

            var htmlMemb = ''

            for(var i = 0; i < array.length; i++){
                htmlMemb += '<input type="checkbox" id="' + family + '_' + array[i].nome + '" >'
                htmlMemb += '<label for="' + family + '_' + array[i].nome + '">' + family + ' ' + array[i].nome + '</label>'
            }
            console.log(htmlMemb)
            $("#contMember").prepend(htmlMemb)
            
            $("#contMember").fadeIn()

        }

    </script>

</body>
</html>

