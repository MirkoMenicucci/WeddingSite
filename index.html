<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MirkoNicoleWedding</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <form id="confPresenza">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="email">Cognome</label>
                    <input type="email" class="form-control" id="cognome" placeholder="Inserisci il tuo Cognome">
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="name">Name</label>
                    <input type="text" class="form-control" id="nome" placeholder="Inserisci il tuo Nome">
                </div>
            </div>
            <div class="col-md-12">
                <button type="button" id="ricerca" class="btn btn-primary">Ricerca</button>
                <button type="reset" class="btn btn-secondary">Reset</button>
            </div>
        </div>
    </form>
    <form id="contMember">
        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="comments">Comments</label>
                    <textarea class="form-control" id="note" rows="3" placeholder="Indica se ci sono allergie o particolari richieste sul cibo"></textarea>
                </div>
            </div>
            <div class="col-md-12">
                <div class="form-group">
                    <button type="button" id="Invia" class="btn btn-primary">Conferma Partecipazione</button>
                    <button type="reset" class="btn btn-secondary">Reset</button>
                </div>
            </div>
        </div>
    </form>
    
</div>

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    var listaPartecipanti = [
        {
            "family":"Prete",
            "membri":[
                {
                    "nome":"Simone",
                },
                {
                    "nome":"Lidia",
                },
                {
                    "nome":"Lisa",
                },
            ]
        }
        ,{
            "family":"Viscito",
            "membri":[
                {
                    "nome":"Bruno",
                },
                {
                    "nome":"Riccardo",
                },
                {
                    "nome":"Jacopo",
                },
                {
                    "nome":"Anna",
                },
            ]
        }
        ,{
            "family":"Menicucci",
            "membri":[
                {
                    "nome":"Lucas",
                },
                {
                    "nome":"Francesca",
                },
            ]
        }
        ,{
            "family":"Menicucci",
            "membri":[
                {
                    "nome":"Salvatore",
                },
                {
                    "nome":"Stefania",
                },
            ]
        }
    ]

    $(document).ready(function(){
        $("#ricerca").on("click",function(){
            ricerca()
        })
        $("#reset").on("click",function(){
            reset()
        })
        $("#contMember").hide()
    })

    function reset() {
        $("form").find("input").val("")
        $("form").find("textarea").text("")
    }

    function ricerca() {
        var cognome = $("#cognome").val().toLowerCase(); // Convert to lowercase for case-insensitive search
        var nome = $("#nome").val().toLowerCase(); // Convert to lowercase for case-insensitive search
        var matchingParticipants = [];

        for (var i = 0; i < listaPartecipanti.length; i++) {
            var currentFamily = listaPartecipanti[i];

            if (currentFamily.family.toLowerCase() === cognome) {
                for (var j = 0; j < currentFamily.membri.length; j++) {
                    var currentMember = currentFamily.membri[j];
                    matchingParticipants.push({
                        cognome: currentFamily.family,
                        nome: currentMember.nome
                    });
                }
                break; // Una volta trovata la famiglia, possiamo uscire dal ciclo principale
            }
        }

        // Ordinare l'array in modo che il membro con il nome specificato sia al primo posto
        matchingParticipants.sort(function(a, b) {
            if (a.nome.toLowerCase() === nome) {
                return -1;
            }
            if (b.nome.toLowerCase() === nome) {
                return 1;
            }
            // Se nessuno dei due nomi corrisponde, ordinare alfabeticamente
            return a.nome.toLowerCase().localeCompare(b.nome.toLowerCase());
        });

        step1(matchingParticipants,cognome)
    }

    function step1(array,family){
        $("#confPresenza").fadeOut()

        var htmlMemb = ''

        for(var i = 0; i < array.length; i++){
            htmlMemb += '<input type="checkbox" id="' + family + '_' + array[i].nome + '" >'
            htmlMemb += '<label for="' + family + '_' + array[i].nome + '">' + family + ' ' + array[i].nome + '</label>'
        }
        console.log(htmlMemb)
        $("#contMember").prepend(htmlMemb)
        
        $("#contMember").fadeIn()

    }

    function getMemberList(){
        $.ajax({
            url: 'getMemberlist.php',  // URL della tua pagina PHP
            type: 'POST',
            data: {
                cognome: $("#cognome").val().toLowerCase(),
                nome: $("#nome").val().toLowerCase()
            },
            success: function(response) {
                alert(response);  // Mostra la risposta nel div con id "result"
            },
            error: function(xhr, status, error) {
                console.error(error);
            }
        });
    }
</script>
</body>
</html>
